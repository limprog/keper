









Реализация системы анализа активности учащихся на занятии с помощью компьютерного зрения 








Оглавление

Введение	3
3. Технологический стек	6
4. Исследование нейронных сетей для реализации классификатора экрана.	7
1. res2net[2]	8
2. shufflenet_v2 [3]	8
3. ResNext[4]	9
5. Захват экрана и сбор датасета	10
5. Разметка данных	12
7. База данных	14
8. Телеграм-бот	15
9. Управление разработкой проекта	16
10. Результат проекта	16
11. Будущее развитие	17
12. Заключение	17
Источники информации	17















Введение
В данной работе показан процесс реализации проктора-помощника с использованием нейронных сетей для проведение занятий в учебных заведениях. Программный комплекс позволяет ненавязчиво следить за экранами пользователей и собирать статистику. 

Актуальность этого проекта заключается в том, что на занятиях было замечена невыполнение заданий по причине отвлечения на онлайн-игры или занятия, которые не соответствуют основной деятельностью. Преподаватель не всегда сможет это заметить, так как может быть отвлечен на помощь другим ученикам. Это может помешать нормальному образовательному процессу,  и привести к снижению эффективности образования. Мой проект поможет сделать задачу прокторинга несколько проще, потому что этот процесс стремится к максимальной автоматизации. Также программный продукт позволит осуществить сбор цифрового следа учащихся для анализа эффективности занятий.

Целью работы является создание программной системы прокторинга и объединения их в один сервис.

Задачами работы являются:
разработка архитектуры приложения;
сбор данных;
создание приложения для сбора данных;
создание разметчика; 
создание пользовательского интерфейса;
создание базы данных;
создание телеграмм-бота;
выдвинуть гипотезы по решению задачи;
обучение нейронную сеть для классификации скриншотов;
выполнение тестирования написанной программы.

Новизна проекта заключается  заключается в исследовании применимости нейронных сетей для этой задачи. 
Описание приложения
Приложение позволяет осуществлять частичное наблюдение и сбор статистики о деятельности учащихся на занятии с помощью осуществления и автоматической проверкой скриншота. Приложения, установленные на компьютерах, отправляют на сервер (локальный или удалённый) скриншот экрана, который анализируется с помощью нейронных сетей, информация о событии сохраняется. В случае, если деятельность учащегося не соответствует необходимой, то приходит сообщение педагогу с помощью чат-бота. Далее педагог принимает решение, что делать в этом случае. 
На рисунке 1 представлена диаграмма прецедентов использования программного комплекса. На основе данных, посылаемых учащемуся, возможно осуществлять сбор статистики, который будет доступен и самому ученику. Преподаватель имеет возможность зарегистрировать себя и компьютеры, получать доступ к статистике приложения и информацию о деятельности учащихся в реальном времени. 


Рис. 1 - Диаграмма прецедентов использования




Архитектура приложения 
Приложение имеет клиент-сервисную архитектуру.
Выделяют два вида клиентов: 
клиент-ученик (реализован в виде консольного приложения, запускаемого в фоне)
клиент-педагог (реализован в виде телеграмм-бота).
Серверное приложение обрабатывает поступающие запросы с клиентов, проверяет с помощью модели компьютерного зрения, записывает информацию в лог, и отправляет в телеграмм-бот для отправки преподавателю, работающему в текущий момент в этом кабинете. Педагог может выбрать, является ли это нарушением в данный момент, если нет - то в лог запишется информация о том, что разрешено. Работа приложения схематично представлена диаграммой последовательностей на рисунке 2. 


Рисунок 2 - Диаграмма последовательностей работы проекта

Технологический стек
Проект реализован на языке программирования Python.
Для серверной части использовалась библиотека Flask. Отправка запросов с клиента на сервер реализована с помощью библиотеки requests.
Для хранения данных используется база данных SQLite. 
Для реализации чат-бота использована библиотека aiogram[1].
Для создания интерфейса разметчика использована библиотека tkinter. 
Для разработки классификатора скриншотов использована библиотека mmclassification, нейронные сети реализованы с помощью библиотеки Pytorch.

Исследование нейронных сетей для реализации классификатора экрана.
Для классификации деятельности учащегося используются свёрточные нейронные сети. Целью этого этапа было исследование, можно ли использовать нейронные сети для задачи классификации скриншотов по виду деятельности. 
Изначально было две гипотезы:
Прямая классификация изображения.
Определения сложности изображения.

Под прямой классификацией подразумевается определение класса скриншота по виду деятельности. Данный вид работы более прост для реализации, однако имеет ограничения: классификация возможна только на ту деятельность, для который был обучен классификатор. При решении данной задачи можно было пойти двумя путями: выбирать более широкие классы (хорошо/плохой), или более узкие (для каждой задачи свой класс (программирование, решение задач, игры и т.д.)).

Гипотеза, основанная на определении сложности изображения, более сложная в реализации. Она основана на понимании, что сайты и программы для полезной деятельности имеют более высокую визуальную сложность, т.е. больше элементов, более яркие цвета. Однако в связи со сложностью реализации было принято решение сконцентрироваться на первой гипотезе.
	Для обучения нейронной сети нужно её найти. Как показала практика, самописная нейронная сеть показывает плохие результаты даже на относительно легких датасетах, поэтому самописная нейронная сеть для решения этой задачи нам не подходит. 
	Был осуществлен поиск в Интернете и найдена библиотека моделей MMClassification[2], инкапсулирующая процесс обучения и проверки нейронных сетей, а также содержащая предобученные модели. Для теста были выбраны несколько популярных архитектур нейронных сетей:


res2net[2]
Остаточная нейронная сеть, называемая “ResNet”, является известной искусственной нейронной сетью. Она собирается на конструкциях, полученных из клеток пирамиды коры головного мозга. Остаточные нейронные сети достигают этого с помощью коротких путей или “пропущенных соединений” для перемещения по различным слоям. Специалисты реализуют традиционные модели остаточных нейросетей с двух- или трёхслойными пропусками, содержащими пакетную нормализацию и нелинейность между ними. Ученые, занимающиеся данными, также используют дополнительную матрицу весов для изучения весов пропуска в некоторых случаях.


Рисунок 3 - схема сети ResNet.

shufflenet_v2 [3]
Чрезвычайно эффективная архитектура CNN под названием ShuffleNet, которая разработана специально для мобильных устройств с очень ограниченной вычислительной мощностью (например, 10-150 MFLOP). В новой архитектуре используются две новые операции, точечная групповая свертка и перетасовка каналов, что позволяет значительно снизить стоимость вычислений при сохранении точности. Эксперименты по классификации ImageNet и обнаружению объектов MS COCO демонстрируют превосходную производительность ShuffleNet по сравнению с другими структурами, например. более низкая ошибка первого уровня (абсолютная 7,8%), чем недавняя задача классификации MobileNet на ImageNet, при бюджете вычислений 40 MFLOP. На мобильном устройстве на базе ARM ShuffleNet достигает фактического ускорения примерно в 13 раз по сравнению с AlexNet, сохраняя при этом сопоставимую точность.

Рисунок 4 - схема сети ShuffleNet2.
ResNext[4]
ResNet'ы – это мощные глубокие нейронные сети, появившиеся на основании работ Кайминга Хе и пр. в 2015 и 2016, чьи прорывы позволили обучать сотни или даже тысячи слоев с хорошей производительностью. ResNet'ы достигли прекрасной общей производительности на задачах распознавания изображений, и быстро стала одной из самых популярных архитектур в различных задачах машинного зрения.

После чего нужно попробовать несколько датасетов. Для начала используется набор данных с двумя классами. При 10 эпох получится результат примерно 80 процентов. Это хороший результат. Однако что будет если попробовать больше классов. При таком же обучении получился примерно такой же результат, но нужно учитывать что нейронная сеть начала понимать что-такое хорошо, а что такое плохо. Потому что классов стало больше и она стала чаще попадать  в понятие первых двух классов.

Название сети
Точность 
res2net
0.25
shufflenet_v2
1.0
ResNext
0.85

	Таблица 1 - результаты обучения нейронных сетей.

Метрика точности вычисляется по формуле Количество правильных результатовКоличество результатов.
Захват экрана и сбор датасета
	Одним из важнейших модулей  данного проекта является инструмент для захвата экрана. Данный модуль необходимым для того, чтобы фиксировать деятельность учащегося в настоящий момент с помощью скриншота (снимка экрана). 
В проекте реализован сам механизм захвата экрана и два вида возможного запуска: в ручном режиме для сбора датасета для обучения нейронной сети и в автоматическом режиме для фиксации действий.  Захват экрана реализован с помощью библиотеки pyautogui.


class Screenshoot():
   def __init__(self, der=today):
       os.makedirs("data", exist_ok=True)
       os.makedirs(os.path.join('data', der), exist_ok=True)


   def screen(self,der=today):
       os.makedirs("data", exist_ok=True)
       os.makedirs(os.path.join('data', der), exist_ok=True)
       now = datetime.now()
       now_time = now.strftime("%H_%M_%S")
       screen = pyautogui.screenshot(os.path.join('data', der, f'{now_time}.png'))
       print(screen)
       resize(image=screen)
       departure(now_time, screen, der)


def main():
while True:
scrin.screen(today)
time.sleep(random.randint(1, 2))

Листинг 1 - Захват экрана.


Инструмент для ручного режима выделен в отдельный модуль и имеет параметры для запуска, позволяющие настроить сбор данных: 
количество скриншотов;
время между скриншотами;
разброс по времени между скриншотами;
путь к директории;
сохранение параметров.
	Весь этот функционал доступен только с использованием специального пароля, который пользователь указывает. Для парсинга аргументов используется библиотека argparse.
С помощью данного инструмента было собрано около 1000 изображений четырёх классов. В таблице 1 представлены примеры изображений и классов. 

Название класса
Пример изображения



colab





pycharm




game




stepik


Таблица 1 - примеры классов.
5. Разметка данных
Можно подойти к задаче разметки с нескольких сторон:
сбор псевдо-данных с заранее определённым классом;
сбор реальных данных.
Сбор псевдо-данных заключается в запуске инструмента для захвата экрана (скриншотера) на определённое время и симуляция или реальное выполнения работы определённого, заранее утверждённого класса. Например, запуск на 15 минут скриншотера и игра в это время с последующим сохранением данных в ручном режиме.
Сбор реальных данных подразумевает запуск без уведомления и дальнейшую разметку вручную.  Для разметки датасета был разработан специальный инструмент, позволяющий в ручном режиме разделить изображения на нужные классы. Данный инструмент использует библиотеку tkinter. C её помощью помощью создается окно, в котором расположены классы разметки и изображение которое размечается с помощью нажатия на кнопку.

	Рисунок - 2 - Разметчик

Сервер

Сервер осуществляет коммуникацию между клиентами на компьютерах и клиентом в чат-боте. Он реализует функции для анализа скриншотов. Скриншот, снятый на компьютере ученика по методом POST передаётся на сервер, где производится анализ с помощью нейронной сети, далее запрос посылается в чат-бот. С другой стороны, сервер обрабатывает поступающие запросы с чат-бота по управлению пользователями, реализуя REST-API для доступа к базе данных. Реализованы методы типа GET, POST, PUT, DELETE для получения информации, добавления пользования, обновления информации и удаления пользователя соответственно. 

@app.route('/reg', methods=['POST'])

def reg():
    data = request.form
    print(data)
    conn, cur = get_db_connection()

    conn.execute('INSERT INTO users(name, nickname, position, timetable, tgid, cod) VALUES (?, ?, ?, ?, ?, ?)', (data['name'], data['nickname'], data["position"], data['timetable'], data['tgid'], data["cod"],))

    conn.commit()
    conn.close()

    return ('', 204)



Листинг 2 - добавление пользователя.

Рисунок 3 - Схема связей между между клиентам и сервером.
База данных
База данных предназначена для хранения данных пользователей (педагогов), расписания работы и информации о компьютерах. На основе базы данных производится проверка, какому пользователю необходимо отправлять предупреждение или информацию и производится аутентификация пользователя. Выбрана реляционная база данных.
Эта база данных реализована с помощью SQLite, доступ осуществляется через интерфейс на языке Python. На рисунке 3 можно найти её схему.

Рисунок 4 - ER-модель БД
Телеграм-бот
Телеграм-бот осуществляет функции клиента для педагога. Через него можно просматривать приходящую активность учащихся.  Также через чат-бот реализована регистрация и аутентификация пользователя. Чат-бот реализован с помощью библиотеки aiogram. 
Реализовано меню управления с помощью команд. 







Рисунок 5 - меню чат-бота.

При проверке действий на сервере и обнаружении подозрительной активности сервер сверяет номер компьютера с расписанием и отправляет преподавателю, работающему в текущий момент, сообщение в телеграм бота.



Рисунок 6   -  Ответ сервера.

Управление разработкой проекта
Для управления задачами использовался трекер задач трелло. Для отслеживания изменений использовалась система контроля версий Git на платформе GitHub. С его помощью можно отследить процесс разработки проекта и откатится на любую версию. На данный момент здесь всего 53 коммита.
	
Рисунок 4 - Репозиторий проекта
Результат проекта
В результате данного проекта разработана программная система, состоящая из ПО для создания датасета скриншотов экрана, проведено исследование нейронных сетей для классификации изображений в контексте классификации скриншотов, реализовано программное обеспечение для сервера, клиента-ученика и клиента-педагога. 
На данный момент реализовано MVP (минимально работающий продукт) программной системы для внутреннего тестирования и проверки гипотез без учёта безопасности и настроек систем. В настоящее время цель работы данного программного комплекса - сбор цифрового следа для анализа продуктивности работы учащихся. Для этого запускается клиентская часть на на компьютерах учащихся и серверная часть с анализом изображения раз в минуту. За счёт этого можно построить график активности учащегося на занятии.
Будущее развитие
	Планируется доработка проекта с помощью увеличения обучающей выборки. Планируется доработка чат-бота (совершенствование механизмом и функций), возможность удаленного доступа, сообщение на компьютер(предупреждения для учеников), а также возможность встроенного  до обучения для быстрого расширения работы.
Возможно исследование других способов анализа деятельности учащегося с использованием системных функций для оптимизации работы и комбинации их.
Заключение
	Данный проект является мягким способ решения проблемы работы с активностью учащихся на занятии, при его использовании не приходится использовать более жесткие меры например полное отключение каких-либо сайтов, тем самым оставляя возможность отдохнуть ученикам при отключении устройства. Но при этом с ведением удаленного доступа это будет эффективным способом решения проблемы.          

Список литературы
​​Aiogram repository // GitHub URL: https://github.com/aiogram/aiogram (дата обращения: 10.01.2023).
He K. [и др.]. Deep Residual Learning for Image Recognition // 2015.
Zhang X. [и др.]. ShuffleNet: An Extremely Efficient Convolutional Neural Network for Mobile Devices // 2017.
MMClassification Contributors. OpenMMLab's Image Classification Toolbox and Benchmark.//2020
Xie S. [и др.]. Aggregated Residual Transformations for Deep Neural Networks // 2016.
